<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

# Bayes Theory 貝氏定理

我們先敘述貝氏定理，等一下再舉一個在快思慢想書裡面的例子，來看貝氏定理怎麼用，為何重要。 <br>

假設 $A, B$ 是兩個隨機事件， $P(A), P(B)$ 都不為 $0$，貝氏說了

$$P(A|B) = \frac{P(B|A)P(A)}{P(B)}$$

證明:

$$P(A|B) P(B) = P(A \cap B) = P(B|A) P(A)$$

我們來看看 快思慢想 (作者 Kahneman) 提到 基準比例謬誤 (base rate neglect fallacy) <br>
某天夜晚城裡發生了一件車禍，肇事的車子逃逸，但有證人指認那是一輛藍色的計程車。城裡只有藍色、綠色兩種計程車；綠色車佔 85% ，藍色車僅佔 15% 。法庭檢驗證人在夜晚識別車色的能力，發現他識別正確的機率是80%，而識別錯誤的機率是20%。

當 Kahneman 做實驗問受測者肇事車輛為藍色的機率多少時，大部分人的答案是 80%。這是犯了「基準比例謬誤 」的答案，也就是城裡「綠色車佔85%，藍色車佔15%」這個基率所包含的資訊被忽略了。如果把基率納入考量，貝氏定理給的答案是

$$Pr(肇事車真為藍色|證人指認為藍色) = \frac{P(證人指認為藍色|肇事車真為藍色)P(肇事車真為藍色)}{P(證人指認為藍色)} \sim 0.41379$$

跟你想的答案一樣嗎? 80%, 41%， 你選哪一個，我們下面來詳細拆解。

假設有 100 輛車，根據已知 85 綠， 15 藍。

|  | 證人認對 | 證人認錯 | 總數 |
| :-----| :----: | :----: | :----: |
| 藍車 | 證人答藍車(BT) | 證人答綠車(BF) | 15|
| 綠車 | 證人答綠車(GT) | 證人答藍車(GF) | 85|
| 總數 | 80 | 20 | 100 |

我們一一來看，(BT)，(BF)，(GT)，(GF)，那四格因該是多少。

- (BT) = 15 * 4/5 = 12
- (BF) = 15 * 1/5 = 3
- (GT) = 85 * 4/5 = 68
- (GF) = 85 * 1/5 = 17

所以表格為

|  | 證人認對 | 證人認錯 | 總數 |
| :-----| :----: | :----: | :----: |
| 藍車 | 12 | 3 | 15|
| 綠車 | 68 | 17 | 85|
| 總數 | 80 | 20 | 100 |

那問題答案

$$Pr(肇事車真為藍色|證人指認為藍色) = \frac{12}{12+17} \sim 0.41379$$

我們可以用貝氏再看一這個問題

$$\frac{P(證人指認為藍色|肇事車真為藍色)P(肇事車真為藍色)}{P(證人指認為藍色)} = \frac{\frac{12}{12+3} * \frac{15}{100}}{ \frac{12+17}{100}} = \frac{12}{12+17}$$

如果 $A,B$ 有順序，我們也可以用這種方式理解貝氏，

$$\begin{aligned}
    P(A|B) &= P(B|A) &*& P(A) &/& P(B) \\
    預測機率 &= 概似機率 &*& 先驗機率 &/& 條件發生機率 \\
    Posterior &= Likelihood &*& Prior &/& Evidence \\
    \end{aligned}$$

我們把 $A, B$ 帶入上面的問題， $A =$  肇事車真為藍色， $B =$ 證人指認為藍色，
因為在城裡面只有藍車 $15$ 輛，綠車 $85$ 輛，我們在還沒開庭前會有個預設概念是藍車的機率是 $0.15$ 這也是被稱為先驗機率，
也可以理解為事發之前的機率，假設城裡每個開車的每個人出車禍的機率都一樣。 <br>

然後證人上法庭，指認說是藍色車，這就是證據 evidence，通常這個機率是常數，你可以想成，大家一看到這個證人，對他的眼力視力與當天夜晚的狀況等等有的概念。 <br>

那接下來我們會想問的就是假設 "肇事車真為藍色" 這前題下，證人指認出為藍色的機率是多少，因為證人也可能認錯，這個機率也被稱為概似機率。 <br>

在開庭前我們有一個之前的刻板印象 $P(A)$ 先驗機率，看完證人是誰，與他的指認，我們就會產生新的機率 $P(A|B)$ 也被稱為 後驗機率。 <br>

我們也可以看很多的證據(我指傳喚很多證人去指證)去得到比較準確的機率。

我們再舉一個例子以垃圾郵件為例，我們剛收到一封新的信件，原本對一封信是不是垃圾郵件有一個印象，雖然我常常收沒用的信(例如阿醜的抱怨信)，但是我還是很常需要信箱幫我收重要的信阿(例如小美的情書)，
但是我可以建立一些特別的關鍵字去做塞選，例如裡面出現阿醜那有很大概率是垃圾信，裡面出現小美那很大概率是重要的信，但是也可能是誤判，例如阿醜在信裡面提到小美很漂亮想做朋友，這明顯是阿醜寫的垃圾信，但是信裡面有提到小美。 <br>

如果上面的例子還不能感受到貝氏的概念，我再舉一個我們平常會發生的例子，假設你去抽獎，我們在抽之前會對中獎機率有一個概念，然後你從上面開始刮，刮出個 ``謝謝`` 兩個字，那根據你多年豐富的人生經歷你還會刮嗎，這就是你看到一些證據後的後驗機率，那如果你看到 ``恭喜`` 兩個字，你會不會開心，當然也可能是 恭喜發財 再接再厲。
